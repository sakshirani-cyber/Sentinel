spring.application.name=sentinel-backend

spring.datasource.url=jdbc:postgresql://aws-1-eu-central-1.pooler.supabase.com:5432/postgres?sslmode=require
spring.datasource.username=postgres.tpxkwjdltahqiubpkyon
spring.datasource.password=Sentinel#123$Pwhu323

server.address=0.0.0.0
server.port=8080

spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false

# ==================== CONNECTION POOL OPTIMIZATION ====================
# HikariCP Pool Settings (Balanced with Supabase free tier limits)
# Supabase free tier: ~60 pooled connections (leaving headroom for other services)
spring.datasource.hikari.maximum-pool-size=8
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=20000

# JDBC Batch Insert Optimization - Critical for batch performance
# This enables JDBC batching for saveAll() operations
spring.jpa.properties.hibernate.jdbc.batch_size=100
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true

# Rewrite batch inserts as multi-row inserts (PostgreSQL specific optimization)
spring.datasource.hikari.data-source-properties.reWriteBatchedInserts=true

# ==================== REDIS CONFIGURATION ====================
spring.data.redis.master.host=above-javelin-22882.upstash.io
spring.data.redis.master.port=6379
spring.data.redis.master.password=AVliAAIncDIwNWFiMWExYjIxMDE0ODQ0OWEyYmVkNDczZDc2ZmIwM3AyMjI4ODI

spring.data.redis.slave.host=above-javelin-22882.upstash.io
spring.data.redis.slave.port=6379
spring.data.redis.slave.password=AVliAAIncDIwNWFiMWExYjIxMDE0ODQ0OWEyYmVkNDczZDc2ZmIwM3AyMjI4ODI

# ==================== CACHE TTL ====================
cache.poll.ttl.minutes=60
cache.poll.results.ttl.minutes=5
cache.sse.events.ttl.hours=24

# ==================== BATCH INSERT CONFIGURATION ====================
# Batch insert service settings for PollResult entities
# Batch when: 100 results collected OR 500ms elapsed (whichever comes first)
batch.poll-result.size=100
batch.poll-result.timeout-ms=500
batch.poll-result.queue-capacity=10000

# Enable async DB sync
async.db.sync.enabled=true

# ==================== CIRCUIT BREAKER CONFIGURATION ====================
resilience4j.circuitbreaker.instances.redis.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.redis.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.redis.sliding-window-size=10

resilience4j.circuitbreaker.instances.database.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.database.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.database.sliding-window-size=10

# ==================== RETRY CONFIGURATION ====================
resilience4j.retry.instances.database.max-attempts=3
resilience4j.retry.instances.database.wait-duration=500ms
resilience4j.retry.instances.database.retry-exceptions=java.net.ConnectException,java.sql.SQLTransientConnectionException,org.springframework.dao.QueryTimeoutException,org.springframework.dao.TransientDataAccessException
resilience4j.retry.instances.database.ignore-exceptions=org.springframework.dao.DataIntegrityViolationException,org.springframework.dao.DuplicateKeyException,jakarta.validation.ConstraintViolationException

# ==================== THREAD POOL CONFIGURATION ====================
# Async executor for DB operations
# Reduced to avoid overwhelming free tier resources
executor.core-pool-size=10
executor.max-pool-size=50
executor.queue-capacity=2000
executor.thread-name-prefix=async-executor-

scheduler.pool-size=10

# ==================== MONITORING ====================
management.endpoints.web.exposure.include=health,metrics,prometheus
management.metrics.export.prometheus.enabled=true